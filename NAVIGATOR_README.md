# Habitat导航应用程序使用说明

## 概述

这是一个基于Habitat-sim和PyQt5开发的交互式3D场景导航应用程序。应用程序提供了直观的图形界面，允许用户在HM3D数据集的3D场景中进行导航和探索。

## 功能特性

### 1. 双视图界面
- **左侧**: 实时第一人称视角（FPV），显示智能体当前视野
- **右侧**: 动态俯视地图，显示场景布局和智能体位置

### 2. 导航功能
- **初始位置设置**: 输入坐标将智能体瞬移到指定位置
- **路径寻找**: 自动寻找最优路径并以动画形式移动
- **碰撞检测**: 自动检查位置是否可导航

### 3. 视角控制
- **传感器旋转**: 在静止时调整摄像头视角
- **支持的命令**: left, right, up, down + 角度值

### 4. 实时地图
- **坐标系**: 显示世界坐标系和网格线
- **智能体标记**: 红点表示位置，红色箭头表示朝向
- **动态更新**: 移动时实时更新位置和朝向

## 安装要求

### 系统要求
- Linux系统 (推荐 Ubuntu 18.04+)
- Python 3.7+
- 支持OpenGL的显卡

### 依赖安装

1. **Habitat-sim** (核心依赖):
   ```bash
   # 通过conda安装 (推荐)
   conda install habitat-sim -c conda-forge -c aihabitat
   
   # 或从源码安装
   git clone https://github.com/facebookresearch/habitat-sim.git
   cd habitat-sim
   pip install .
   ```

2. **Python依赖**:
   ```bash
   pip install -r requirements.txt
   ```

3. **系统依赖** (Ubuntu):
   ```bash
   sudo apt-get update
   sudo apt-get install python3-pyqt5 python3-pyqt5.qtwidgets
   ```

## 使用方法

### 1. 启动应用程序

```bash
# 方法1: 使用启动脚本
./start_app.sh

# 方法2: 直接运行Python脚本
python3 habitat_navigator_app.py
```

### 2. 修改场景文件路径

在 `habitat_navigator_app.py` 的主函数中修改 `scene_filepath` 变量：

```python
scene_filepath = "/path/to/your/scene.glb"
```

### 3. 基本操作

#### 设置初始位置
1. 在输入框中输入坐标，格式: `x, z`
   - 例: `2.5, -3.1`
2. 按回车或点击"执行"按钮
3. 如果位置可导航，智能体将瞬移到该位置

#### 导航到目标点
1. 输入目标坐标: `x, z`
2. 应用程序将:
   - 检查目标点是否可达
   - 计算最优路径
   - 以动画形式移动智能体
   - 实时更新视角和地图

#### 调整视角 (仅在静止时)
支持的命令格式: `方向 角度`

- `left 30` - 向左转30度
- `right 45` - 向右转45度  
- `up 15` - 向上看15度
- `down 20` - 向下看20度

### 4. 界面说明

#### 状态信息
- **状态标签**: 显示当前操作状态和提示信息
- **状态栏**: 显示系统级状态信息

#### 地图说明
- **红点**: 智能体当前位置
- **红色箭头**: 智能体身体朝向
- **网格线**: 坐标参考系
- **坐标标签**: 显示世界坐标范围

## 技术实现

### 坐标系统
- **世界坐标**: Habitat-sim的3D坐标系 (x, y, z)
- **地图坐标**: 2D像素坐标 (px, py)
- **转换函数**: `world_to_map_coords()` 实现线性映射

### 路径规划
- 使用 `sim.pathfinder.find_path()` 进行路径规划
- 自动避开障碍物和不可导航区域
- 支持复杂场景的多点路径

### 视角控制
- **身体朝向**: 影响移动方向和地图箭头
- **传感器朝向**: 仅影响FPV视野，不改变地图标记
- 使用四元数进行旋转计算

### 动画系统
- 使用QTimer实现平滑移动动画
- 100ms更新间隔确保流畅体验
- 自动计算朝向以面向移动方向

## 故障排除

### 常见问题

1. **模拟器初始化失败**
   - 检查场景文件路径是否正确
   - 确认Habitat-sim正确安装
   - 检查显卡驱动和OpenGL支持

2. **PyQt5相关错误**
   ```bash
   # 安装完整的PyQt5
   pip install PyQt5 PyQt5-tools
   
   # 或使用系统包管理器
   sudo apt-get install python3-pyqt5
   ```

3. **场景文件不存在**
   - 下载HM3D测试场景
   - 或使用Habitat提供的示例场景

4. **导航失败**
   - 确保输入坐标在场景范围内
   - 检查目标位置是否可导航
   - 尝试使用场景中心附近的坐标

### 性能优化

1. **降低分辨率**: 修改 `resolution` 参数
2. **减少动画频率**: 增加 `QTimer` 间隔
3. **简化地图渲染**: 减少网格线密度

## 扩展功能

### 可能的改进
1. **多传感器支持**: 添加深度图、语义分割等
2. **路径可视化**: 在地图上显示规划路径
3. **交互式地图**: 支持鼠标点击导航
4. **场景信息面板**: 显示场景统计信息
5. **录制功能**: 保存导航过程为视频

### 自定义配置
- 修改传感器参数（分辨率、视域角度等）
- 调整地图样式（颜色、标记大小等）
- 添加新的命令处理逻辑

## 许可证

本项目基于Habitat-sim的许可证。使用前请确保遵守相关开源协议。

## 技术支持

如遇问题，请检查：
1. Habitat-sim官方文档
2. PyQt5官方文档  
3. 项目依赖的版本兼容性
